@page "/pricehistory"
@page "/pricehistory/{Id:int}"

@using HomeAppsBlazerServer.Models
@using HomeAppsBlazerServer.Servcies
@using HomeAppsBlazerServer.Servcies.Shopping
@using Microsoft.AspNetCore.Mvc

@inject IShoppingServices ShoppingServices
@inject NavigationManager NavigationManger

@rendermode InteractiveServer

@layout HomeAppsBlazerServer.Components.Layout.Shopping.ShoppingLayout


@{
    var showClass = IsVisible ? "d-block" : "d-none";
}


@if (priceHistory == null)
{
}

else if (priceHistory.Count().Equals(0))
{
    <div class="toast-container position-fixed start-0 p-3 mt-5 @showClass" style="top: 100px;" data-bs-autohide="true" data-bs-delay="5000">

        <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">@ItemName - No past prices</strong>
                <button type="button" class="btn-close" aria-label="Close" @onclick="Close"></button>
            </div>

            <div class="toast-body">
                @foreach (var itemprice in priceHistory)
                {
                    <div>@itemprice.PriceDate.ToShortDateString() - @itemprice.Amount - @itemprice?.Store?.StoreName </div>
                }
            </div>
        </div>
    </div>
}

else if(priceHistory is not null)
{

    <div class="toast-container position-fixed start-0 p-3 mt-5 @showClass" style="top: 100px;" data-bs-autohide="true" data-bs-delay="5000">
        
    <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <strong class="me-auto">@ItemName - @priceHistory.FirstOrDefault().ItemID</strong>
            <button type="button" class="btn-close" aria-label="Close" @onclick="Close"></button>
        </div>

        <div class="toast-body">
            @foreach (var itemprice in priceHistory)
            {
                    <div>@itemprice.PriceDate.ToShortDateString() - $@itemprice.Amount @(string.IsNullOrEmpty(itemprice?.Store?.StoreName) ? "" : $"- {itemprice.Store.StoreName}")</div>
            }
        </div>
    </div>
    </div>
}






@code {
    [Parameter]
    public int? Id { get; set; }

    public List<PriceHistory> priceHistory { get; set; }


    [Parameter]
    public bool IsVisible { get; set; }

    [Parameter]
    public EventCallback<bool> IsVisibleChanged { get; set; }

    [Parameter]
    public string? HeaderText { get; set; }

    [Parameter]
    public string? BodyText { get; set; }

    private string ItemName = string.Empty;

    public void Show(List<PriceHistory> priceHistories, string itemname)
    {
        // HeaderText = headerText;
        // BodyText = bodyText;
        IsVisible = true;
        ItemName = itemname;

        priceHistory = priceHistories;

        StateHasChanged();
    }

    private void Close()
    {
        HeaderText = string.Empty;
        BodyText = string.Empty;
        IsVisible = false;
        //StateHasChanged();
    }


    protected override async Task OnParametersSetAsync()
    {
        if (Id is not null)
        {
            var PriceHistory = await ShoppingServices.GetPriceHisotry((int)(Id));

            if (PriceHistory is not null)
            {
                priceHistory = PriceHistory;
            }
        }

    }






    [HttpPost]
    //not working
    async Task Deleteitems()
    {
        //delete
        await ShoppingServices.RemoveShoppingItem((int)Id);

        //NavigationManger.NavigateTo($"Shoppingitemss/");
    }

    async Task HandleSubmit()
    {

        //add
        //await ShoppingServices.AddPriceToHistry(PriceHistory);
        //NavigationManger.NavigateTo($"Shoppingitemss/");



    }

}
